[ -f ~/.zsh_pre ] && source ~/.zsh_pre

source ~/.zgen/zgen.zsh

# enable vim mode
set -o vi
#bindkey jj vi-cmd-mode

# command history
bindkey "^R" history-incremental-search-backward
bindkey "^F" history-incremental-search-forward
bindkey "^[[A" history-beginning-search-backward
bindkey "^[[B" history-beginning-search-forward
# This is more direct, but not as nice: bindkey -s '^x^x' '!!\n'
bindkey '^x^x' repeat-last-command

if ! zgen-saved; then
    echo "Creating a zgen save"

    zgen oh-my-zsh

    # Devservers should have different prompt than my workstations.
    # My workstations are always Arch
    if [[ $(uname -r | grep -o '....$') == "ARCH" ]]; then
        zgen load caiogondim/bullet-train-oh-my-zsh-theme bullet-train
    else
        zgen oh-my-zsh themes/steeef
    fi

    # Shell Syntax Highlighting
    zgen load zsh-users/zsh-syntax-highlighting

    # oh-my-zsh Plugins
    zgen oh-my-zsh plugins/catimg
    zgen oh-my-zsh plugins/common-aliases
    zgen oh-my-zsh plugins/git
    zgen oh-my-zsh plugins/mercurial
    zgen oh-my-zsh plugins/jsontools
    zgen oh-my-zsh plugins/pip
    zgen oh-my-zsh plugins/python
    zgen oh-my-zsh plugins/sprunge
    # zgen oh-my-zsh plugins/ssh-agent
    zgen oh-my-zsh plugins/sudo
    zgen oh-my-zsh plugins/systemd
    zgen oh-my-zsh plugins/tmux
    zgen oh-my-zsh plugins/torrent
    zgen oh-my-zsh plugins/virtualenv
    zgen oh-my-zsh plugins/wd

    # Save zgen profile
    zgen save
fi

[ -z $DISPLAY ] || BROWSER=google-chrome-stable

[ -f ~/.zsh_aliases ] && source ~/.zsh_aliases
[ -f ~/.zsh_post ] && source ~/.zsh_post
[ -f ~/.zsh_theme ] && source ~/.zsh_theme
[ -f /etc/grc.zsh ] && source /etc/grc.zsh

# FZF
[ -f ~/.fzf.zsh ] \
    || git clone --depth 1 https://github.com/junegunn/fzf.git ~/.fzf \
    ~/.fzf/install \
    ln -s ~/.fzf/fzf ~/.local/bin/

[ -f ~/.fzf.zsh ] \
    && source ~/.fzf.zsh \
    && _fzf_compgen_path() { ag -g "" "$1" }

export FZF_DEFAULT_COMMAND='ag -g ""'
export FZF_CTRL_T_COMMAND="$FZF_DEFAULT_COMMAND"
export FZF_DEFAULT_OPTS='
 --color=fg:242,bg:236,hl:65,fg+:15,bg+:239,hl+:108
 --color=info:108,prompt:109,spinner:108,pointer:168,marker:168
'




export BULLETTRAIN_PROMPT_ORDER=(
    time
    status
    custom
    context
    dir
    perl
    ruby
    virtualenv
    go
    git
    hg
    cmd_exec_time
)
